<!DOCTYPE html>
<html>
<head>
  <title>Fog Road Safety</title>
 
  <!-- Load Face API -->
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>

  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="firebaseConfig.js"></script>
</head>
<body>
  <!-- Button to toggle the camera -->
<button id="toggleCameraBtn">Start Driver Camera</button>

<!-- Video preview for driver -->
<video id="driverCam" width="320" height="240" autoplay muted playsinline style="display: none;"></video>
<!-- Drowsiness Warning Box -->
<div id="drowsyAlertBox" class="alert-box" style="display: none;">
  ⚠️ Drowsiness Detected!
</div>

<!-- Beep Sound -->
<audio id="drowsyBeep" src="beep.mp3" preload="auto"></audio>

  <div class="loading-screen" id="loadingScreen">
    <div class="loader"></div>
  </div>

  <h1> Fog Road Safety System</h1>
  <div id="map"></div>
  <div id="alertBox">⚠️ WARNING: Another vehicle is within 1 KM!</div>
 
 
  <div id="petrolInfo" style="margin-top:10px;font-weight:bold;color:#0a58ca;"></div>
  
  <div class="floating-cards">
    <div class="card" id="speedCard">Speed: 0 km/h</div>
    <div class="card" id="coordCard">Lat: 0, Lng: 0</div>
    <div class="card" id="nearbyCard">Nearby Vehicles: 0</div>
  </div>
  <div class="floating-controls">
    <div class="control-btn" onclick="refreshPage()">🔄</div>
    <div class="control-btn" onclick="centerMap()">📍</div>
    <div class="control-btn" onclick="toggleAlerts()">🤍</div>
    <div class="control-btn" onclick="toggleBreakdown()">🛠️</div> <!-- NEW -->
    <div class="control-btn" onclick="handleEmergency()">sos</div>

  </div>

  <button id="findPetrolButton" onclick="handleFindPetrolPump()">
     ⛽
</button>

  <audio id="alertSound" src="beep.mp3" preload="auto"></audio>

  <!-- Load Google Maps API first -->
  <script async defer 
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCeQ_yL8idO59wW7s8qlmZb3bKkJnjK1D8&callback=initMap&v=weekly">
  </script>

  <script>
    // Add these to your existing script.js
    function centerMap() {
       console.log("centerMap called");
         if (map && myLocation) {
            map.panTo(myLocation);
         map.setZoom(15);
         setTimeout(() => map.setZoom(14), 500);
        } else {
         console.log("map or myLocation not ready");
         }
        }


    function toggleAlerts() {
      const btn = document.querySelector('.control-btn:nth-child(2)');
      alertsMuted = !alertsMuted;
      btn.textContent = alertsMuted ? '🔔' : '🔕';
      btn.style.background = alertsMuted ? '#00C851' : '#00bcd4';
    }
    function refreshPage() {
      window.location.reload(); // This refreshes only the current page

    }
    let isBreakdown = false;

function toggleBreakdown() {
  isBreakdown = !isBreakdown;
  updateLocation();
  alert(isBreakdown ? "Marked as Breakdown Vehicle" : "Breakdown Cleared");
}

  </script>
  
  <!-- Then your application script -->
  <script src="script.js"></script>
  <link rel="stylesheet" href="style.css">
  <script defer src="camera.js"></script>

</body>
</html>